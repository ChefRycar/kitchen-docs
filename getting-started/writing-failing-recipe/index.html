<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge' http-equiv='X-UA-Compatible'>
    <title>kitchen-docs preview server</title>
    <meta content='Test Kitchen' name='description'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <link href="/css/kitchen.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://fonts.googleapis.com/css?family=Open+Sans" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://fonts.googleapis.com/css?family=Inconsolata" media="screen" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div class='container'>
      <h1>Getting Started Guide</h1>
      <div class='progress'>
        <div aria-valuemax='100' aria-valuemin='0' aria-valuenow='guide_progress' class='progress-bar' role='progressbar' style='width: 78.94736842105263%;'>
          <span class='sr-only' id='78.94736842105263% Complete'></span>
        </div>
      </div>
    </div>
    <div class='container guide'>
      <div class='row'>
        <div class='article col-md-8'>
          <span id='githubs'>
            <h2>Writing a Failing Recipe</h2>
            <a href='http://github.com/heavywater/kitchen-docs/edit/master/source/getting-started/writing-failing-recipe.md'>
              <div class='glyphicon glyphicon-pencil'></div>
            </a>
          </span>
          <p>So far our cookbook has no dependencies on other cookbooks to get its job done which is awesome! But let's say we require dependant cookbooks. For our example we'll be relying on the <a href="http://community.opscode.com/cookbooks/runit">runit</a> cookbook to manage our Git Daemon service.</p>&#x000A;&#x000A;<p>With this solution in mind we'll Create a file called <code>recipes/server.rb</code> with the following:</p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="n">include_recipe</span> <span class="s2">"git"</span>&#x000A;<span class="n">include_recipe</span> <span class="s2">"runit"</span>&#x000A;&#x000A;<span class="n">package</span> <span class="s2">"git-daemon-run"</span>&#x000A;&#x000A;<span class="n">runit_service</span> <span class="s2">"git-daemon"</span> <span class="k">do</span>&#x000A;  <span class="n">sv_templates</span> <span class="kp">false</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;<p>Reasonably straight forward code. Here's what is going on:</p>&#x000A;&#x000A;<ul>&#x000A;  <li>We include our default Git recipe so that Git is installed. Hey we all ready solved that one, right?</li>&#x000A;  <li>We include the default recipe from the runit cookbook which installs runit and provides the <code>runit_service</code> resource.</li>&#x000A;  <li>We install the <code>git-daemon-run</code> package which gives us the <code>git-daemon</code> program, on Ubuntu 12.04 at least.</li>&#x000A;  <li>Finally, we declare a runit service called <code>git-daemon</code> without generating the run and log scripts (they were provided by the Ubuntu package).</li>&#x000A;</ul>&#x000A;&#x000A;<p>Now to see the fruits of our effort:</p>&#x000A;&#x000A;<pre class="highlight plaintext">$ kitchen verify server-ubuntu-1204&#x000A;-----&gt; Starting Kitchen (v1.0.0)&#x000A;-----&gt; Converging &lt;server-ubuntu-1204&gt;...&#x000A;       Preparing files for transfer&#x000A;       Preparing current project directory as a cookbook&#x000A;       Removing non-cookbook files before transfer&#x000A;       Transfering files to &lt;server-ubuntu-1204&gt;&#x000A;[2013-12-01T23:59:22+00:00] INFO: Forking chef instance to converge...&#x000A;Starting Chef Client, version 11.8.0&#x000A;[2013-12-01T23:59:22+00:00] INFO: *** Chef 11.8.0 ***&#x000A;[2013-12-01T23:59:22+00:00] INFO: Chef-client pid: 1307&#x000A;[2013-12-01T23:59:22+00:00] INFO: Setting the run_list to ["recipe[git::server]"] from JSON&#x000A;[2013-12-01T23:59:22+00:00] INFO: Run List is [recipe[git::server]]&#x000A;[2013-12-01T23:59:22+00:00] INFO: Run List expands to [git::server]&#x000A;[2013-12-01T23:59:22+00:00] INFO: Starting Chef Run for server-ubuntu-1204&#x000A;[2013-12-01T23:59:22+00:00] INFO: Running start handlers&#x000A;[2013-12-01T23:59:22+00:00] INFO: Start handlers complete.&#x000A;Compiling Cookbooks...&#x000A;&#x000A;================================================================================&#x000A;Recipe Compile Error in /tmp/kitchen/cookbooks/git/recipes/server.rb&#x000A;================================================================================&#x000A;&#x000A;&#x000A;Chef::Exceptions::CookbookNotFound&#x000A;----------------------------------&#x000A;Cookbook runit not found. If you're loading runit from another cookbook, make sure you configure the dependency in your metadata&#x000A;&#x000A;&#x000A;Cookbook Trace:&#x000A;---------------&#x000A;  /tmp/kitchen/cookbooks/git/recipes/server.rb:2:in `from_file'&#x000A;&#x000A;&#x000A;Relevant File Content:&#x000A;----------------------&#x000A;/tmp/kitchen/cookbooks/git/recipes/server.rb:&#x000A;&#x000A;  1:  include_recipe "git"&#x000A;  2&gt;&gt; include_recipe "runit"&#x000A;  3:&#x000A;  4:  package "git-daemon-run"&#x000A;         5:&#x000A;         6:  runit_service "git-daemon" do&#x000A;         7:      sv_templates false&#x000A;         8:  end&#x000A;         9:&#x000A;&#x000A;&#x000A;[2013-12-01T23:59:22+00:00] ERROR: Running exception handlers&#x000A;[2013-12-01T23:59:22+00:00] ERROR: Exception handlers complete&#x000A;       [2013-12-01T23:59:22+00:00] FATAL: Stacktrace dumped to /tmp/kitchen/cache/chef-stacktrace.out&#x000A;&#x000A;Chef Client failed. 0 resources updated&#x000A;[2013-12-01T23:59:22+00:00] ERROR: Cookbook runit not found. If you're loading runit from another cookbook, make sure you configure the dependency in your metadata&#x000A;[2013-12-01T23:59:22+00:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)&#x000A;&gt;&gt;&gt;&gt;&gt;&gt; Converge failed on instance &lt;server-ubuntu-1204&gt;.&#x000A;&gt;&gt;&gt;&gt;&gt;&gt; Please see .kitchen/logs/server-ubuntu-1204.log for more details&#x000A;&gt;&gt;&gt;&gt;&gt;&gt; ------Exception-------&#x000A;&gt;&gt;&gt;&gt;&gt;&gt; Class: Kitchen::ActionFailed&#x000A;&gt;&gt;&gt;&gt;&gt;&gt; Message: SSH exited (1) for command: [sudo -E chef-solo --config /tmp/kitchen/solo.rb --json-attributes /tmp/kitchen/dna.json  --log_level info]&#x000A;&gt;&gt;&gt;&gt;&gt;&gt; ----------------------&#x000A;</pre>&#x000A;<p>See what the Chef run told you?</p>&#x000A;&#x000A;<blockquote>&#x000A;  <blockquote>&#x000A;    <p>"Cookbook runit not found. If you're loading runit from another cookbook, make sure you configure the dependency in your metadata"</p>&#x000A;  </blockquote>&#x000A;</blockquote>&#x000A;&#x000A;<p>Hey, that's exactly what we need to do!</p>&#x000A;&#x000A;
          <hr>
          <div id='suggestions'>
            <div class='row'>
              <div class='col-md-7 pull-left'>
                <span></span>
              </div>
              <div class='col-md-5 pull-right'>
                <a class='button btn btn-primary' href='adding-dependency'>
                  Adding a Dependency
                  <i class='glyphicon glyphicon-circle-arrow-right'></i>
                </a>
              </div>
            </div>
          </div>
        </div>
        <div class='col-md-4'>
          <ul class='sections'>
            <li>
              <a href='installing'>Installing Test Kitchen</a>
            </li>
            <li>
              <a href='getting-help'>Getting Help</a>
            </li>
            <li>
              <a href='creating-cookbook'>Creating a Cookbook</a>
            </li>
            <li>
              <a href='writing-recipe'>Writing a Recipe</a>
            </li>
            <li>
              <a href='running-converge'>Running Kitchen Converge</a>
            </li>
            <li>
              <a href='manually-verifying'>Manually Verifying</a>
            </li>
            <li>
              <a href='writing-test'>Writing a Test</a>
            </li>
            <li>
              <a href='running-verify'>Running Kitchen Verify</a>
            </li>
            <li>
              <a href='running-test'>Running Kitchen Test</a>
            </li>
            <li>
              <a href='adding-platform'>Adding a Platform</a>
            </li>
            <li>
              <a href='fixing-converge'>Fixing Converge</a>
            </li>
            <li>
              <a href='adding-feature'>Adding a New Feature</a>
            </li>
            <li>
              <a href='adding-suite'>Adding a Suite</a>
            </li>
            <li>
              <a href='writing-server-test'>Writing a Server Test</a>
            </li>
            <li>
              <a href='writing-failing-recipe'>Writing a Failing Recipe</a>
            </li>
            <li>
              <a href='adding-dependency'>Adding a Dependency</a>
            </li>
            <li>
              <a href='backfilling-platforms'>Backfilling Platforms</a>
            </li>
            <li>
              <a href='next-steps'>Next Steps</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </body>
  <script src="/js/vendor/modernizr-2.6.2.min.js" type="text/javascript"></script>
  <script src="/js/all.js" type="text/javascript"></script>
</html>
